<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-06-22 五 12:48 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>python Descriptor</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Yu Yang" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="static/css/main.css"/>
<link rel="shortcut icon" href="static/img/favicon.ico" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<div id="header">
      <div class="inner">
        <h1 id="site-title"><a href="/"> 编码者言 </a></h1>
        <div>
          <a href="###" id="site-nav-btn">菜单</a>
          <ul id="site-nav" class="vertical-nav mobi-hid">
            <li> <a href="/">Home</a></li>
            <li> <a href="/about.html">About</a></li>

            <li> <a href="/tags.html">Tags</a></li>

            <li> <a href="/atom.xml">RSS</a></li>
          </ul>

          <form id="site-search" method="get" action="https://google.com/search">
            <input type="hidden" name="q" value="site:yuyang0.github.io" />
            <input type="text" name="q" placeholder="Search..." />
            <button class="btn-search" type="submit">Search</button>
          </form>
          <div style="clear:both;"> </div>
        </div>
      </div>
    </div>
</div>
<div id="content">
<h1 class="title">python Descriptor</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org01253fb">Abstract</a></li>
<li><a href="#orgac61e43">Definition and Introduction</a></li>
<li><a href="#org46db00d">Descriptor Protocol</a></li>
<li><a href="#orgd1c9bf4">Invoking Descriptors</a></li>
<li><a href="#org039412a">Descriptor Example</a></li>
<li><a href="#org8a0de63">Properties</a></li>
<li><a href="#org16345d8">Functions and Methods</a></li>
<li><a href="#org819a627">Static Methods and Class Methods</a></li>
</ul>
</div>
</div>
<blockquote>
<p>
Location: <a href="http://users.rcn.com/python/download/Descriptor.htm">http://users.rcn.com/python/download/Descriptor.htm</a> How-To Guide for Descriptors
</p>

<p>
Author: Raymond Hettinger Contact: &lt;python at rcn dot com&gt; Copyright: Copyright (c) 2003, 2004 Python Software
Foundation. All rights reserved.
</p>
</blockquote>

<div id="outline-container-org01253fb" class="outline-2">
<h2 id="org01253fb">Abstract</h2>
<div class="outline-text-2" id="text-org01253fb">
<p>
Defines descriptors, summarizes the protocol, and shows how descriptors are called. Examines a custom
descriptor and several built-in python descriptors including functions, properties, static methods, and
class methods. Shows how each works by giving a pure Python equivalent and a sample application.
</p>

<p>
Learning about descriptors not only provides access to a larger toolset, it creates a deeper understanding
of how Python works and an appreciation for the elegance of its design.
</p>
</div>
</div>

<div id="outline-container-orgac61e43" class="outline-2">
<h2 id="orgac61e43">Definition and Introduction</h2>
<div class="outline-text-2" id="text-orgac61e43">
<p>
In general, a descriptor is an object attribute with "binding behavior", one whose attribute access has
been overridden by methods in the descriptor protocol. Those methods are <span class="underline"><span class="underline">get</span></span>, <span class="underline"><span class="underline">set</span></span>, and
<span class="underline"><span class="underline">delete</span></span>. If any of those methods are defined for an object, it is said to be a descriptor.
</p>

<p>
The default behavior for attribute access is to get, set, or delete the attribute from an object's
dictionary. For instance, a.x has a lookup chain starting with a._<sub>dict</sub>__['x'], then type(a)._<sub>dict</sub>__['x'],
and continuing through the base classes of type(a) excluding metaclasses. If the looked-up value is an
object defining one of the descriptor methods, then Python may override the default behavior and invoke the
descriptor method instead. Where this occurs in the precedence chain depends on which descriptor methods
were defined. Note that descriptors are only invoked for new style objects or classes (a class is new style
if it inherits from object or type).
</p>

<p>
Descriptors are a powerful, general purpose protocol. They are the mechanism behind properties, methods,
static methods, class methods, and super(). They are used used throughout Python itself to implement the
new style classes introduced in version 2.2. Descriptors simplify the underlying C-code and offer a
flexible set of new tools for everyday Python programs.
</p>
</div>
</div>

<div id="outline-container-org46db00d" class="outline-2">
<h2 id="org46db00d">Descriptor Protocol</h2>
<div class="outline-text-2" id="text-org46db00d">
<ul class="org-ul">
<li>descr._<sub>get</sub>_<sub>(self, obj, type=None)</sub> &#x2013;&gt; value</li>

<li>descr._<sub>set</sub>_<sub>(self, obj, value)</sub> &#x2013;&gt; None</li>

<li>descr._<sub>delete</sub>_<sub>(self, obj)</sub> &#x2013;&gt; None</li>
</ul>

<p>
That is all there is to it. Define any of these methods and an object is considered a descriptor and can
override default behavior upon being looked up as an attribute.
</p>

<p>
If an object defines both <span class="underline"><span class="underline">get</span></span> and <span class="underline"><span class="underline">set</span></span>, it is considered a data descriptor. Descriptors that only
define <span class="underline"><span class="underline">get</span></span> are called non-data descriptors (they are typically used for methods but other uses are
possible).
</p>

<p>
Data and non-data descriptors differ in how overrides are calculated with respect to entries in an
instance's dictionary. If an instance's dictionary has an entry with the same name as a data descriptor,
the data descriptor takes precedence. If an instance's dictionary has an entry with the same name as a
non-data descriptor, the dictionary entry takes precedence.
</p>

<p>
To make a read-only data descriptor, define both <span class="underline"><span class="underline">get</span></span> and <span class="underline"><span class="underline">set</span></span> with the <span class="underline"><span class="underline">set</span></span> raising an
AttributeError when called. Defining the <span class="underline"><span class="underline">set</span></span> method with an exception raising placeholder is enough to
make it a data descriptor.
</p>
</div>
</div>

<div id="outline-container-orgd1c9bf4" class="outline-2">
<h2 id="orgd1c9bf4">Invoking Descriptors</h2>
<div class="outline-text-2" id="text-orgd1c9bf4">
<p>
A descriptor can be called directly by its method name. For example, d._<sub>get</sub>_<sub>(obj)</sub>.
</p>

<p>
Alternatively, it is more common for a descriptor to be invoked automatically upon attribute access. For
example, obj.d looks up d in the dictionary of obj.  If d defines the method <span class="underline"><span class="underline">get</span></span>, then d._<sub>get</sub>_<sub>(obj)</sub>
is invoked according to the precedence rules listed below.
</p>

<p>
The details of invocation depend on whether obj is an object or a class. Either way, descriptors only work
for new style objects and classes. A class is new style if it is a subclass of object.
</p>

<p>
For objects, the machinery is in object._<sub>getattribute</sub>__ which transforms b.x into
type(b)._<sub>dict</sub>__['x']._<sub>get</sub>_<sub>(b, type(b))</sub>. The implementation works through a precedence chain that gives
data descriptors priority over instance variables, instance variables priority over non-data descriptors,
and assigns lowest priority to <span class="underline"><span class="underline">getattr</span></span> if provided. The full C implementation can be found in
PyObject<sub>GenericGetAttr</sub>() in Objects/object.c.
</p>

<p>
For classes, the machinery is in type._<sub>getattribute</sub>__ which transforms B.x into
B._<sub>dict</sub>__['x']._<sub>get</sub>_<sub>(None, B)</sub>. In pure Python, it looks like:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__getattribute__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, key<span style="color: #DCDCCC;">)</span>:
    <span style="color: #9FC59F;">"Emulate type_getattro() in Objects/typeobject.c"</span>
    <span style="color: #DFAF8F;">v</span> = <span style="color: #DCDCCC; font-weight: bold;">object</span>.__getattribute__<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, key<span style="color: #DCDCCC;">)</span>
    <span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #DCDCCC; font-weight: bold;">hasattr</span><span style="color: #DCDCCC;">(</span>v, <span style="color: #CC9393;">'__get__'</span><span style="color: #DCDCCC;">)</span>:
       <span style="color: #F0DFAF; font-weight: bold;">return</span> v.__get__<span style="color: #DCDCCC;">(</span><span style="color: #BFEBBF;">None</span>, <span style="color: #F0DFAF; font-weight: bold;">self</span><span style="color: #DCDCCC;">)</span>
    <span style="color: #F0DFAF; font-weight: bold;">return</span> v
</pre>
</div>

<p>
The important points to remember are:
</p>

<ul class="org-ul">
<li>descriptors are invoked by the <span class="underline"><span class="underline">getattribute</span></span> method</li>
<li>overriding <span class="underline"><span class="underline">getattribute</span></span> prevents automatic descriptor calls</li>
<li>_<sub>getattribute</sub>__ is only available with new style classes and objects</li>
<li>object._<sub>getattribute</sub>__ and type._<sub>getattribute</sub>__ make different calls to <span class="underline"><span class="underline">get</span></span>.</li>
<li>data descriptors always override instance dictionaries.</li>
<li>non-data descriptors may be overridden by instance dictionaries.</li>
</ul>

<p>
The object returned by super() also has a custom <span class="underline"><span class="underline">getattribute</span></span> method for inv ng descriptors. The call
super(B, obj).m() sea ches obj._<sub>class</sub>__._<sub>mro</sub>__ for the base class A immed ely following B and then returns
A._<sub>dict</sub>__['m']._<sub>get</sub>_<sub>(obj, A)</sub>. If not a descriptor, m is return unchanged. If not in the dictionary, m
reverts to a search using object._<sub>getattribute</sub>__.
</p>

<p>
Note, in Python 2.2, super(B, obj).m() would only invoke <span class="underline"><span class="underline">get</span></span> if m was a data scriptor. In Python 2.3,
non-data descriptors also get invoked unless an old-style class is involved. The plementation details are in
super<sub>getattro</sub>() in Objects/typeobject.c and a pure Python equivalent can be found in <a href="http://www.python.org/2.2.3/descrintro.%20%20tml#cooperation">Guido's</a> <a href="http://www.python.org/2.2.3/descrintro.html#cooperation">Tutorial</a>.
</p>

<p>
The details above show that the mechanism for descriptors is embedded in the _<sub>g</sub> ttribute_<sub>()</sub> methods for
object, type, and uper. Classes inherit this machinery when they derive fr object or if they have a
meta-class providing similar functionality. Likewise, classes can turn-o descriptor invocation by overriding
_<sub>getattribute</sub>_<sub>()</sub>.
</p>
</div>
</div>

<div id="outline-container-org039412a" class="outline-2">
<h2 id="org039412a">Descriptor Example</h2>
<div class="outline-text-2" id="text-org039412a">
<p>
The following code creates a class whose objects are data descriptors which prin message for each get or
set. Overriding <span class="underline">_ etattribute_</span> is alternate approach that could do this fo ery attribute. However, this
descriptor is useful for monitoring just a few chosen attributes:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">RevealAccess</span><span style="color: #DCDCCC;">(</span><span style="color: #DCDCCC; font-weight: bold;">object</span><span style="color: #DCDCCC;">)</span>:
    <span style="color: #9FC59F;">"""A data descriptor that sets and returns values</span>
<span style="color: #9FC59F;">       normally and prints a message logging their access.</span>
<span style="color: #9FC59F;">    """</span>

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, initval=<span style="color: #BFEBBF;">None</span>, name=<span style="color: #CC9393;">'var'</span><span style="color: #DCDCCC;">)</span>:
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.val = initval
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.name = name

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__get__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, obj, objtype<span style="color: #DCDCCC;">)</span>:
        <span style="color: #F0DFAF; font-weight: bold;">print</span> <span style="color: #CC9393;">'Retrieving'</span>, <span style="color: #F0DFAF; font-weight: bold;">self</span>.name
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.val

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__set__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, obj, val<span style="color: #DCDCCC;">)</span>:
        <span style="color: #F0DFAF; font-weight: bold;">print</span> <span style="color: #CC9393;">'Updating'</span> , <span style="color: #F0DFAF; font-weight: bold;">self</span>.name
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.val = val

<span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">MyClass</span><span style="color: #DCDCCC;">(</span><span style="color: #DCDCCC; font-weight: bold;">object</span><span style="color: #DCDCCC;">)</span>:
    <span style="color: #DFAF8F;">x</span> = RevealAccess<span style="color: #DCDCCC;">(</span><span style="color: #BFEBBF;">10</span>, <span style="color: #CC9393;">'var "x"'</span><span style="color: #DCDCCC;">)</span>
    <span style="color: #DFAF8F;">y</span> = <span style="color: #BFEBBF;">5</span>

&gt;&gt;&gt; <span style="color: #DFAF8F;">m</span> = MyClass<span style="color: #DCDCCC;">()</span>
&gt;&gt;&gt; m.x
Retrieving var <span style="color: #CC9393;">"x"</span>
<span style="color: #BFEBBF;">10</span>
&gt;&gt;&gt; <span style="color: #DFAF8F;">m.x</span> = <span style="color: #BFEBBF;">20</span>
Updating var <span style="color: #CC9393;">"x"</span>
&gt;&gt;&gt; m.x
Retrieving var <span style="color: #CC9393;">"x"</span>
<span style="color: #BFEBBF;">20</span>
&gt;&gt;&gt; m.y
<span style="color: #BFEBBF;">5</span>
</pre>
</div>

<p>
The protocol is simple and offers exciting possibilities. Several use cases a o common that they have been
packaged into ndividual function calls.  Properties, bound and unbound m ds, static methods, and class
methods are all based on the descriptor protocol.
</p>
</div>
</div>

<div id="outline-container-org8a0de63" class="outline-2">
<h2 id="org8a0de63">Properties</h2>
<div class="outline-text-2" id="text-org8a0de63">
<p>
Calling property() is a succinct way of building a data descriptor that triggers ction calls upon access to
an attribute. Its signature is:
</p>

<p>
property(fget=None, fset=None, fdel=None, doc=None) -&gt; property attribute
</p>

<p>
The documentation shows a typical use to define a managed attribute x:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">C</span><span style="color: #DCDCCC;">(</span><span style="color: #DCDCCC; font-weight: bold;">object</span><span style="color: #DCDCCC;">)</span>:
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">getx</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span><span style="color: #DCDCCC;">)</span>: <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.__x
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">setx</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, value<span style="color: #DCDCCC;">)</span>: <span style="color: #F0DFAF; font-weight: bold;">self</span>.__x = value
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">delx</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span><span style="color: #DCDCCC;">)</span>: <span style="color: #F0DFAF; font-weight: bold;">del</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.__x
    <span style="color: #DFAF8F;">x</span> = <span style="color: #DCDCCC; font-weight: bold;">property</span><span style="color: #DCDCCC;">(</span>getx, setx, delx, <span style="color: #CC9393;">"I'm the 'x' property."</span><span style="color: #DCDCCC;">)</span>
</pre>
</div>
<p>
To see how property() is implemented in terms of the descriptor protocol, here is a pure Python equivalent:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Property</span><span style="color: #DCDCCC;">(</span><span style="color: #DCDCCC; font-weight: bold;">object</span><span style="color: #DCDCCC;">)</span>:
    <span style="color: #9FC59F;">"Emulate PyProperty_Type() in Objects/descrobject.c"</span>

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, fget=<span style="color: #BFEBBF;">None</span>, fset=<span style="color: #BFEBBF;">None</span>, fdel=<span style="color: #BFEBBF;">None</span>, doc=<span style="color: #BFEBBF;">None</span><span style="color: #DCDCCC;">)</span>:
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.fget = fget
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.fset = fset
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.fdel = fdel
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.<span style="color: #DCDCCC; font-weight: bold;">__doc__</span> = doc

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__get__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, obj, objtype=<span style="color: #BFEBBF;">None</span><span style="color: #DCDCCC;">)</span>:
        <span style="color: #F0DFAF; font-weight: bold;">if</span> obj <span style="color: #F0DFAF; font-weight: bold;">is</span> <span style="color: #BFEBBF;">None</span>:
            <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>
        <span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.fget <span style="color: #F0DFAF; font-weight: bold;">is</span> <span style="color: #BFEBBF;">None</span>:
            <span style="color: #F0DFAF; font-weight: bold;">raise</span> <span style="color: #7CB8BB;">AttributeError</span>, <span style="color: #CC9393;">"unreadable attribute"</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.fget<span style="color: #DCDCCC;">(</span>obj<span style="color: #DCDCCC;">)</span>

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__set__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, obj, value<span style="color: #DCDCCC;">)</span>:
        <span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.fset <span style="color: #F0DFAF; font-weight: bold;">is</span> <span style="color: #BFEBBF;">None</span>:
            <span style="color: #F0DFAF; font-weight: bold;">raise</span> <span style="color: #7CB8BB;">AttributeError</span>, <span style="color: #CC9393;">"can't set attribute"</span>
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.fset<span style="color: #DCDCCC;">(</span>obj, value<span style="color: #DCDCCC;">)</span>

    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__delete__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, obj<span style="color: #DCDCCC;">)</span>:
        <span style="color: #F0DFAF; font-weight: bold;">if</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.fdel <span style="color: #F0DFAF; font-weight: bold;">is</span> <span style="color: #BFEBBF;">None</span>:
            <span style="color: #F0DFAF; font-weight: bold;">raise</span> <span style="color: #7CB8BB;">AttributeError</span>, <span style="color: #CC9393;">"can't delete attribute"</span>
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.fdel<span style="color: #DCDCCC;">(</span>obj<span style="color: #DCDCCC;">)</span>


</pre>
</div>
<p>
The property() builtin helps whenever a user interface has granted attribute ess and then subsequent
changes require the intervention of a method.
</p>

<p>
For instance, a spreadsheet class may grant access to a cell value through Ce b10').value. Subsequent
improvements to the pro ram require the cell to be recalculated on every acce however, the programmer does
not want to affect existing client code accessing the attribute direct The solution is to wrap access to
the value attribute in a property() data descriptor:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Cell</span><span style="color: #DCDCCC;">(</span><span style="color: #DCDCCC; font-weight: bold;">object</span><span style="color: #DCDCCC;">)</span>:
    . . .
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">getvalue</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, obj<span style="color: #DCDCCC;">)</span>:
        <span style="color: #9FC59F;">"Recalculate cell before returning value"</span>
        <span style="color: #F0DFAF; font-weight: bold;">self</span>.recalc<span style="color: #DCDCCC;">()</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> obj._value
    <span style="color: #DFAF8F;">value</span> = <span style="color: #DCDCCC; font-weight: bold;">property</span><span style="color: #DCDCCC;">(</span>getvalue<span style="color: #DCDCCC;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org16345d8" class="outline-2">
<h2 id="org16345d8">Functions and Methods</h2>
<div class="outline-text-2" id="text-org16345d8">
<p>
Python's object oriented features are built upon a function based environment.  g non-data descriptors, the
two are merged seamlessly.
</p>

<p>
Class dictionaries store methods as functions. In a class definition, method e written using def and
lambda, the usual tools or creating functions. The only difference from re r functions is that the first
argument is reserved for the object instance. By Python convention the i nce reference is called self but
may be called this or any other variable name.
</p>

<p>
To support method calls, functions include the <span class="underline"><span class="underline">get</span></span> method for bindi ethods during attribute
access. This means that all functions are non-data descriptors which retu ound or unbound methods depending
whether they are invoked from an object or a class. In pure python, it works like this:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Function</span><span style="color: #DCDCCC;">(</span><span style="color: #DCDCCC; font-weight: bold;">object</span><span style="color: #DCDCCC;">)</span>:
    . . .
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__get__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, obj, objtype=<span style="color: #BFEBBF;">None</span><span style="color: #DCDCCC;">)</span>:
        <span style="color: #9FC59F;">"Simulate func_descr_get() in Objects/funcobject.c"</span>
        <span style="color: #F0DFAF; font-weight: bold;">return</span> types.MethodType<span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, obj, objtype<span style="color: #DCDCCC;">)</span>
</pre>
</div>
<p>
Running the interpreter shows how the function descriptor works in practice:
</p>

<pre class="example">
&gt;&gt;&gt; class D(object):
  def f(self, x):
       return x

&gt;&gt;&gt; d = D()
&gt;&gt;&gt; D.__dict__['f'] # Stored internally as a function
&lt;function f at 0x00C45070&gt;
&gt;&gt;&gt; D.f             # Get from a class becomes an unbound method
&lt;unbound method D.f&gt;
&gt;&gt;&gt; d.f             # Get from an instance becomes a bound method
&lt;bound method D.f of &lt;__main__.D object at 0x00B18C90&gt;&gt;
</pre>
<p>
The output suggests that bound and unbound methods are two different types. le they could have been
implemented that way, t e actual C implemention of PyMethod<sub>Type</sub> in Object assobject.c is a single object
with two different representations depending on whether the im<sub>self</sub> fie s set or is NULL (the C equivalent
of None).
</p>

<p>
Likewise, the effects of calling a method object depend on the im<sub>self</sub> field.  et (meaning bound), the
original function (stor d in the im<sub>func</sub> field) is called as expected with th rst argument set to the
instance. If unbound, all of the arguments are passed unchanged to the orig function. The actual C
implementation of instancemethod<sub>call</sub>() is only slightly more complex in t it includes some type checking.
</p>
</div>
</div>

<div id="outline-container-org819a627" class="outline-2">
<h2 id="org819a627">Static Methods and Class Methods</h2>
<div class="outline-text-2" id="text-org819a627">
<p>
Non-data descriptors provide a simple mechanism for variations on the usual pa ns of binding functions into
methods.
</p>

<p>
To recap, functions have a <span class="underline"><span class="underline">get</span></span> method so that they can be converted t method when accessed as
attributes. The non-data de criptor transforms a obj.f (*args) call f(obj, *args). Calling klass.f(*args)
becomes f(*args).
</p>

<p>
This chart summarizes the binding and its two most useful va riants:
</p>

<p>
Transforma tion Called from an Object Ca lled from a Cl ass func ion f(obj, gs) f(<b>args) Descripto r sta
icmethod f(</b> args) f(*args) class method f(type(obj), *args) f(klass, *args)
</p>

<p>
Static methods return the underlying function without changes. Calling either c r C.f is the equivalent of
a direct lookup i to object._<sub>getattribute</sub>__ (c, "f") or object._<sub>getattrib</sub> _(C, "f"). As a result, the
function becomes identically accessible from either an object or a class.
</p>

<p>
Good candidates for static methods are methods that do not reference the self variable.
</p>

<p>
For instance, a statistics package may include a container class for experiment ata. The class provides
normal methods for c mputing the average, mean, median, and other descriptive st tics that depend on the
data. However, there may be useful functions which are conceptually r lat ut do not depend on the data. For
instance, erf(x) is handy conversion routine that comes up in st tical work but does not directly depend on
a articular data set. It can be called either from an obje r the class: s.erf(1.5) &#x2013;&gt; .9332 or
Sample.erf(1.5) &#x2013;&gt; .9332.
</p>

<p>
Since staticmethods return the underlying function with no changes, the example calls are unexciting:
</p>
<pre class="example">
&gt;&gt;&gt; class E(object):
     def f(x):
          print x
     f = staticmethod(f)

&gt;&gt;&gt; print E.f(3)
3
&gt;&gt;&gt; print E().f(3)
3
</pre>
<p>
Using the non-data descriptor protocol, a pure Python version of staticmethod() would look like this:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">StaticMethod</span><span style="color: #DCDCCC;">(</span><span style="color: #DCDCCC; font-weight: bold;">object</span><span style="color: #DCDCCC;">)</span>:
 <span style="color: #9FC59F;">"Emulate PyStaticMethod_Type() in Objects/funcobject.c"</span>

 <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, f<span style="color: #DCDCCC;">)</span>:
      <span style="color: #F0DFAF; font-weight: bold;">self</span>.f = f

 <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__get__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, obj, objtype=<span style="color: #BFEBBF;">None</span><span style="color: #DCDCCC;">)</span>:
      <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.f
</pre>
</div>
<p>
Unlike static methods, class methods prepend the class reference to the argum list before calling the
function. This format s the same for whether the caller is an object or a class:
</p>
<pre class="example">
&gt;&gt;&gt; class E(object):
     def f(klass, x):
          return klass.__name__, x
     f = classmethod(f)

&gt;&gt;&gt; print E.f(3)
('E', 3)
&gt;&gt;&gt; print E().f(3)
('E', 3)
</pre>
<p>
This behavior is useful whenever the function only needs to have a class refere and does not care about any
underlying data.  ne use for classmethods is to create alternate class const ors. In Python 2.3, the
classmethod dict.fromkeys() creates a new dictionary from a li t of keys. The pure Python equivalent is:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">Dict</span>:
    . . .
    <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">fromkeys</span><span style="color: #DCDCCC;">(</span>klass, iterable, value=<span style="color: #BFEBBF;">None</span><span style="color: #DCDCCC;">)</span>:
        <span style="color: #9FC59F;">"Emulate dict_fromkeys() in Objects/dictobject.c"</span>
        <span style="color: #DFAF8F;">d</span> = klass<span style="color: #DCDCCC;">()</span>
        <span style="color: #F0DFAF; font-weight: bold;">for</span> key <span style="color: #F0DFAF; font-weight: bold;">in</span> iterable:
            <span style="color: #DFAF8F;">d</span><span style="color: #DCDCCC;">[</span>key<span style="color: #DCDCCC;">]</span> = value
        <span style="color: #F0DFAF; font-weight: bold;">return</span> d
    <span style="color: #DFAF8F;">fromkeys</span> = <span style="color: #DCDCCC; font-weight: bold;">classmethod</span><span style="color: #DCDCCC;">(</span>fromkeys<span style="color: #DCDCCC;">)</span>
</pre>
</div>
<p>
Now a new dictionary of unique keys can be constructed like this:
</p>
<pre class="example">
 &gt;&gt;&gt; Dict.fromkeys('abracadabra')
{'a': None, 'r': None, 'b': None, 'c': None, 'd': None}
</pre>
<p>
Using the non-data descriptor protocol, a pure Python version of classmethod() would look like this:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #F0DFAF; font-weight: bold;">class</span> <span style="color: #7CB8BB;">ClassMethod</span><span style="color: #DCDCCC;">(</span><span style="color: #DCDCCC; font-weight: bold;">object</span><span style="color: #DCDCCC;">)</span>:
     <span style="color: #9FC59F;">"Emulate PyClassMethod_Type() in Objects/funcobject.c"</span>

     <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__init__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, f<span style="color: #DCDCCC;">)</span>:
          <span style="color: #F0DFAF; font-weight: bold;">self</span>.f = f

     <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">__get__</span><span style="color: #DCDCCC;">(</span><span style="color: #F0DFAF; font-weight: bold;">self</span>, obj, klass=<span style="color: #BFEBBF;">None</span><span style="color: #DCDCCC;">)</span>:
          <span style="color: #F0DFAF; font-weight: bold;">if</span> klass <span style="color: #F0DFAF; font-weight: bold;">is</span> <span style="color: #BFEBBF;">None</span>:
               <span style="color: #DFAF8F;">klass</span> = <span style="color: #DCDCCC; font-weight: bold;">type</span><span style="color: #DCDCCC;">(</span>obj<span style="color: #DCDCCC;">)</span>
          <span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #93E0E3;">newfunc</span><span style="color: #DCDCCC;">(</span>*args<span style="color: #DCDCCC;">)</span>:
               <span style="color: #F0DFAF; font-weight: bold;">return</span> <span style="color: #F0DFAF; font-weight: bold;">self</span>.f<span style="color: #DCDCCC;">(</span>klass, *args<span style="color: #DCDCCC;">)</span>
          <span style="color: #F0DFAF; font-weight: bold;">return</span> newfunc
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="disqus_comment">
<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */

    var disqus_config = function () {
        var url_path = window.location.pathname;
        var disqus_identifier = url_path.substring(url_path.lastIndexOf('/')+1);
        disqus_identifier? disqus_identifier: 'index';

        var full_url = window.location.href.replace(/^http:/, 'https:');
        this.page.url = full_url;
        this.page.identifier = disqus_identifier;
        // this.page.title = document.title;
    };

    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');

        s.src = '//yuyang.disqus.com/embed.js';  // IMPORTANT: Replace EXAMPLE with your forum shortname!

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
<!-- begin footer -->
<div id="footer">
  <ul class="links vertical-nav">
    <li><a href="/sitemap.xml">Sitemap</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    <li><a href="/about.html">About Me</a></li>
    <li><a class="back-to-top" href="#">Back to Top</a></li>
  </ul>
  <span>© 2013 Yu Yang's Blog, Created by org-mode and dropbox</span>
  <a href="#" class="back-to-top" id="fixed-back-to-top" ></a>
</div>
<script src="//apps.bdimg.com/libs/jquery/2.0.0/jquery.min.js"></script>
<script type="text/javascript">
	window.jQuery || document.write('<script src="static/js/jquery-2.0.0.min.js"><\/script>');
	</script>
<script type="text/javascript" src="static/js/custom.js"></script>
<!-- end footer -->
</div>
</body>
</html>